sudo apt-get update
sudo apt-get install -y \
    curl \
    git \
    build-essential \
    nodejs \
    npm \
    rpm \
    golang


curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs


node -v   # doit être >= 18
npm -v


sudo npm install -g yarn
yarn -v   # doit afficher une version ~1.22.x


sudo apt-get install -y golang
go version


git clone https://github.com/ente-io/ente
cd ente/desktop

yarn install
yarn build


-------

# 1️⃣ Aller dans le dossier desktop
cd ~/ente/desktop

# 2️⃣ Supprimer les modules et nettoyer le cache
rm -rf node_modules
yarn cache clean

# 3️⃣ Supprimer le lock file npm qui peut causer des conflits
rm -f package-lock.json

# 4️⃣ Créer/éditer un .yarnrc pour forcer HTTPS
echo -e '--install.pure-lockfile true\ngit "https://github.com/"' > .yarnrc

# 5️⃣ Configurer Git globalement pour remplacer toutes les URL SSH GitHub par HTTPS
git config --global --unset-all url."https://github.com/".insteadOf
git config --global --unset-all url."https://".insteadOf
git config --global url."https://github.com/".insteadOf ssh://git@github.com/
git config --global url."https://github.com/".insteadOf git@github.com:
git config --global url."https://github.com/".insteadOf git://github.com/
# Règle spécifique pour electron/node-gyp
git config --global url."https://github.com/electron/".insteadOf ssh://git@github.com/electron/

# 6️⃣ Vérifier la configuration Git
git config --global --get-regexp url

# 7️⃣ Lancer l’installation Yarn proprement
yarn install


------ 
Guide résumé pour installer Ente Desktop sur Debian 13
1️⃣ Installer les dépendances système
sudo apt update
sudo apt install -y \
    curl \
    git \
    build-essential \
    nodejs \
    npm \
    rpm \
    golang


Node.js doit être >=18.

Vérifie :

node -v
npm -v
go version


Installer Yarn globalement :

sudo npm install -g yarn
yarn -v

2️⃣ Cloner le projet Ente
git clone https://github.com/ente-io/ente
cd ente/desktop

3️⃣ Configurer Git pour éviter les problèmes SSH

Certains packages (ex: electron/node-gyp) utilisent SSH par défaut, ce qui provoque l’erreur Host key verification failed.

# Supprimer anciennes règles conflictuelles
git config --global --unset-all url."https://github.com/".insteadOf
git config --global --unset-all url."https://".insteadOf

# Forcer HTTPS pour GitHub
git config --global url."https://github.com/".insteadOf ssh://git@github.com/
git config --global url."https://github.com/".insteadOf git@github.com:
git config --global url."https://github.com/".insteadOf git://github.com/
# Règle spécifique pour node-gyp / Electron
git config --global url."https://github.com/electron/".insteadOf ssh://git@github.com/electron/


Vérifie la configuration :

git config --global --get-regexp url

4️⃣ Préparer Yarn et le projet
# Supprimer les modules et lock files précédents
rm -rf node_modules
rm -f package-lock.json
yarn cache clean

# Créer un .yarnrc pour forcer HTTPS
echo -e '--install.pure-lockfile true\ngit "https://github.com/"' > .yarnrc

5️⃣ Installer les dépendances via Yarn
yarn install


Cela installe toutes les dépendances, y compris les modules natifs d’Electron.

Cette étape peut prendre quelques minutes.

6️⃣ Compiler Ente Desktop
yarn build


Cette commande crée le binaire exécutable.

Le binaire se trouve généralement dans le dossier dist/.

7️⃣ Lancer Ente Desktop
cd dist
./Ente   # ou le nom exact du fichier généré


Pour tester en mode développement (hot reload) :

yarn dev
