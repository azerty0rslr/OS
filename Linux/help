sudo apt-get update
sudo apt-get install -y \
    curl \
    git \
    build-essential \
    nodejs \
    npm \
    rpm \
    golang


curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs


node -v   # doit √™tre >= 18
npm -v


sudo npm install -g yarn
yarn -v   # doit afficher une version ~1.22.x


sudo apt-get install -y golang
go version


git clone https://github.com/ente-io/ente
cd ente/desktop

yarn install
yarn build


-------

# 1Ô∏è‚É£ Aller dans le dossier desktop
cd ~/ente/desktop

# 2Ô∏è‚É£ Supprimer les modules et nettoyer le cache
rm -rf node_modules
yarn cache clean

# 3Ô∏è‚É£ Supprimer le lock file npm qui peut causer des conflits
rm -f package-lock.json

# 4Ô∏è‚É£ Cr√©er/√©diter un .yarnrc pour forcer HTTPS
echo -e '--install.pure-lockfile true\ngit "https://github.com/"' > .yarnrc

# 5Ô∏è‚É£ Configurer Git globalement pour remplacer toutes les URL SSH GitHub par HTTPS
git config --global --unset-all url."https://github.com/".insteadOf
git config --global --unset-all url."https://".insteadOf
git config --global url."https://github.com/".insteadOf ssh://git@github.com/
git config --global url."https://github.com/".insteadOf git@github.com:
git config --global url."https://github.com/".insteadOf git://github.com/
# R√®gle sp√©cifique pour electron/node-gyp
git config --global url."https://github.com/electron/".insteadOf ssh://git@github.com/electron/

# 6Ô∏è‚É£ V√©rifier la configuration Git
git config --global --get-regexp url

# 7Ô∏è‚É£ Lancer l‚Äôinstallation Yarn proprement
yarn install


------ 
Guide r√©sum√© pour installer Ente Desktop sur Debian 13
1Ô∏è‚É£ Installer les d√©pendances syst√®me
sudo apt update
sudo apt install -y \
    curl \
    git \
    build-essential \
    nodejs \
    npm \
    rpm \
    golang


Node.js doit √™tre >=18.

V√©rifie‚ÄØ:

node -v
npm -v
go version


Installer Yarn globalement‚ÄØ:

sudo npm install -g yarn
yarn -v

2Ô∏è‚É£ Cloner le projet Ente
git clone https://github.com/ente-io/ente
cd ente/desktop

3Ô∏è‚É£ Configurer Git pour √©viter les probl√®mes SSH

Certains packages (ex: electron/node-gyp) utilisent SSH par d√©faut, ce qui provoque l‚Äôerreur Host key verification failed.

# Supprimer anciennes r√®gles conflictuelles
git config --global --unset-all url."https://github.com/".insteadOf
git config --global --unset-all url."https://".insteadOf

# Forcer HTTPS pour GitHub
git config --global url."https://github.com/".insteadOf ssh://git@github.com/
git config --global url."https://github.com/".insteadOf git@github.com:
git config --global url."https://github.com/".insteadOf git://github.com/
# R√®gle sp√©cifique pour node-gyp / Electron
git config --global url."https://github.com/electron/".insteadOf ssh://git@github.com/electron/


V√©rifie la configuration‚ÄØ:

git config --global --get-regexp url

4Ô∏è‚É£ Pr√©parer Yarn et le projet
# Supprimer les modules et lock files pr√©c√©dents
rm -rf node_modules
rm -f package-lock.json
yarn cache clean

# Cr√©er un .yarnrc pour forcer HTTPS
echo -e '--install.pure-lockfile true\ngit "https://github.com/"' > .yarnrc

5Ô∏è‚É£ Installer les d√©pendances via Yarn
yarn install


Cela installe toutes les d√©pendances, y compris les modules natifs d‚ÄôElectron.

Cette √©tape peut prendre quelques minutes.

6Ô∏è‚É£ Compiler Ente Desktop
yarn build


Cette commande cr√©e le binaire ex√©cutable.

Le binaire se trouve g√©n√©ralement dans le dossier dist/.

7Ô∏è‚É£ Lancer Ente Desktop
cd dist
./Ente   # ou le nom exact du fichier g√©n√©r√©


Pour tester en mode d√©veloppement (hot reload)‚ÄØ:

yarn dev


---- 

üîπ Ce que tu peux faire ensuite

Tester le binaire g√©n√©r√©
Apr√®s yarn build, le binaire (ex√©cutable) se trouve normalement dans le dossier dist/ ou similaire.
Pour le lancer‚ÄØ:

cd dist
./Ente  # ou le nom exact du fichier g√©n√©r√©


Tu devrais voir l‚Äôinterface graphique d‚ÄôEnte s‚Äôouvrir.

Mode d√©veloppement (optionnel)
Si tu veux tester avec hot reload (utile pour debug)‚ÄØ:

yarn dev


V√©rifier les fonctionnalit√©s

Cr√©er un compte local

Ajouter/importer des photos

V√©rifier que les photos sont chiffr√©es (bout-en-bout)

Tester l‚Äôinterface et le menu

Automatiser l‚Äôex√©cution (si besoin pour ton TP)
Si tu veux lancer Ente Desktop automatiquement ou via un script, tu peux cr√©er un petit script shell‚ÄØ:

#!/bin/bash
cd /root/ente/desktop/dist

ex√©cution : 
sudo apt install -y fuse libfuse2

cd ~/ente/desktop/dist
./ente-1.7.16-beta-x86_64.AppImage

------
sudo useradd -m -s /bin/bash enteuser
sudo passwd enteuser

sudo chown -R enteuser:enteuser ~/ente

su - enteuser
cd ~/ente/desktop/dist
./ente-1.7.16-beta-x86_64.AppImage

root@vbox:~/ente/desktop/dist# useradd -m -s /bin/bash enteuser
root@vbox:~/ente/desktop/dist# passwd enteuser
New password: 
Retype new password: 
passwd: password updated successfully
root@vbox:~/ente/desktop/dist# chown -R enteuser:enteuser ~/ente
root@vbox:~/ente/desktop/dist# exit
logout
vboxuser@vbox:~$ su - enteuser
Password: 
enteuser@vbox:~$ cd ~/ente/desktop/dist
-bash: cd: /home/enteuser/ente/desktop/dist: No such file or directory
enteuser@vbox:~$ su -
Password: 
root@vbox:~# su - enteuser
enteuser@vbox:~$ cd ~/ente/desktop/dist
-bash: cd: /home/enteuser/ente/desktop/dist: No such file or directory
enteuser@vbox:~$ ^C


--------

1Ô∏è‚É£ Script Shell pour lancer Ente

Cr√©e un fichier start-ente.sh par exemple :

#!/bin/bash
# Script pour lancer Ente Desktop

# Chemin vers l'AppImage
ENTE_APPIMAGE="/root/ente/desktop/dist/ente-1.7.16-beta-x86_64.AppImage"

# V√©rifie si le fichier existe
if [ ! -f "$ENTE_APPIMAGE" ]; then
    echo "Erreur : AppImage introuvable √† $ENTE_APPIMAGE"
    exit 1
fi

# Rendre l'AppImage ex√©cutable
chmod +x "$ENTE_APPIMAGE"

# Lancer Ente Desktop
"$ENTE_APPIMAGE"


Rends le script ex√©cutable :

chmod +x start-ente.sh


Tu peux maintenant tester :

./start-ente.sh

2Ô∏è‚É£ Option : Lancer automatiquement avec systemd

Cr√©e un fichier ente.service dans /etc/systemd/system/ :

[Unit]
Description=Ente Desktop
After=network.target

[Service]
Type=simple
ExecStart=/root/ente/desktop/start-ente.sh
Restart=on-failure
User=root
WorkingDirectory=/root/ente/desktop

[Install]
WantedBy=multi-user.target


Recharge systemd :

sudo systemctl daemon-reload


Active le service pour qu‚Äôil d√©marre automatiquement :

sudo systemctl enable ente.service


D√©marre le service maintenant :

sudo systemctl start ente.service


V√©rifie le statut :

sudo systemctl status ente.service
